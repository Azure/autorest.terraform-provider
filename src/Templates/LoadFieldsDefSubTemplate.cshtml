@using AutoRest.Core
@using AutoRest.Terraform
@using AutoRest.Terraform.Templates
@using System.Collections.Generic
@using System.Diagnostics
@using System.Linq
@inherits TfProviderTemplateBase<(TfProviderField Field, Stack<IDictionary<string, string>> FieldDefs)>
@{
    Debug.Assert(Model.Field != null && Model.FieldDefs != null && Model.FieldDefs.Count > 0);

    var fieldVar = "p" + CodeNamer.GetAzureRmFieldLocalVarName(Model.Field);

    if (Model.FieldDefs.All(def => !def.ContainsKey(Model.Field.PropertyPath)))
    {
        if (Model.Field.Parent.IsRoot)
        {
@:@(Indentation)@(fieldVar) := d.Get("@(Model.Field.Name)").(?)
        }
        else
        {

@:@(Include<LoadFieldsDefSubTemplate, (TfProviderField, Stack<IDictionary<string, string>>)>((Model.Field.Parent, Model.FieldDefs)))

            var parentFieldVar = Model.FieldDefs.First(def => def.ContainsKey(Model.Field.Parent.PropertyPath))[Model.Field.Parent.PropertyPath];

@:@(Indentation)@(fieldVar) := @(parentFieldVar)["@(Model.Field.Name)"].(?)

        }
        Model.FieldDefs.Peek().Add(Model.Field.PropertyPath, fieldVar);
    }
}